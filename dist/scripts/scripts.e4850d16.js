"use strict";angular.module("schedulerUiApp",["ngCookies","ngMessages","ngResource","ngRoute","ui.router","ui.bootstrap","ngMaterial","ngMaterialDatePicker"]).factory("httpinterceptor",["$q","$location","$injector",function(a,b,c){return{request:function(a){if(window.localStorage&&localStorage.getItem("user")){var b=JSON.parse(localStorage.getItem("user")).token;a.headers.Authorization="Bearer "+b}return delete a.headers["content-type"],a}}}]).config(["$stateProvider","$urlRouterProvider","$httpProvider","$locationProvider",function(a,b,c,d){c.interceptors.push("httpinterceptor");var e={auth:["$q","$location",function(a,b){var c=a.defer();return localStorage.getItem("user")?c.resolve({user:function(){return JSON.parse(localStorage.getItem("token"))}}):c.reject(),c.promise}]};b.otherwise("/"),a.state("login",{url:"/",controller:"UserCtrl",templateUrl:"views/login.html"}).state("signup",{url:"/signup",controller:"SignupCtrl",templateUrl:"views/signup.html"}).state("home",{url:"/home",controller:"HomeCtrl",templateUrl:"views/homepage.html",resolve:e}),d.hashPrefix("")}]),angular.module("schedulerUiApp").controller("UserCtrl",["$scope","$state","userService",function(a,b,c){a.errorMsg="",a.login=function(d,e){if(d.$valid){console.log("valid"),a.errorMsg="",a.pageLoader=!0;var f={userName:e.name,password:e.password};c.login(f).then(function(c){a.pageLoader=!1,localStorage.setItem("user",JSON.stringify(c)),b.go("home")},function(b){a.pageLoader=!1,a.errorMsg=b.message})}else a.errorMsg="please enter valid details"}}]),angular.module("schedulerUiApp").controller("HomeCtrl",["$scope","$state","userService",function(a,b,c){a.showSchedules=!0,a.bookSchedules=!1,a.schedulerRole=JSON.parse(localStorage.getItem("user")).canSchedule,a.signOut=function(){localStorage.clear(),b.go("login")},a.minDate=new Date,a.getSchedules=function(){c.getSchedules().then(function(b){a.pageLoader=!1,a.schedulesList=b,angular.forEach(a.schedulesList,function(a){"PST"==JSON.parse(localStorage.getItem("user")).timeZone?a.displayDate=moment(a.scheduleDate).tz("America/Los_Angeles").format("DD-MMM-YY hh:mm A"):a.displayDate=moment(a.scheduleDate).format("DD-MMM-YY hh:mm A")})},function(b){a.pageLoader=!1})},a.getSchedulerList=function(){c.getSchedulerList().then(function(b){a.pageLoader=!1,a.schedulerList=b},function(b){a.pageLoader=!1,a.errorMsg=b.message})},a.scheduler={},a.createSchedule=function(b){a.pageLoader=!0,a.errorMsg="",console.log("scheduleData",b),c.createSchedule(b).then(function(b){a.pageLoader=!1,a.scheduler={},c.showmdToast("success",b.message)},function(b){a.pageLoader=!1,c.showmdToast("error",b.message)})},a.deleteSchedules=function(b){a.pageLoader=!0,a.errorMsg="",c.deleteSchedules(b).then(function(b){c.showmdToast("success",b.message),a.getSchedules()},function(b){a.pageLoader=!1,c.showmdToast("error",b.message)})}}]),angular.module("schedulerUiApp").controller("SignupCtrl",["$scope","$state","userService",function(a,b,c){a.tzList=["IST","PST"],a.errorMsg="",a.signup=function(d,e){if(d.$valid)if(console.log("valid"),e.password==e.confirmPassword){a.errorMsg="",a.pageLoader=!0;var f={userName:e.userName,password:e.password,canSchedule:!0,timeZone:e.timeZone};c.signup(f).then(function(d){a.pageLoader=!1,c.showmdToast("success",d.message),b.go("login")},function(b){a.pageLoader=!1,a.errorMsg=b.message})}else a.errorMsg="passwords not matching";else a.errorMsg="please enter valid details"}}]),angular.module("schedulerUiApp").service("userService",["$q","$http","$mdToast",function(a,b,c){this.signup=function(c){var d=a.defer();return b({method:"POST",url:API_END_POINT+"/user/signup",data:c}).then(function(a){d.resolve(a.data)},function(a){d.reject(a.data)}),d.promise},this.login=function(c){var d=a.defer();return b({method:"POST",url:API_END_POINT+"/user/login",data:c}).then(function(a){d.resolve(a.data)},function(a){d.reject(a.data)}),d.promise},this.getSchedules=function(){var c=a.defer();return b({method:"GET",url:API_END_POINT+"/schedule"}).then(function(a){c.resolve(a.data)},function(a){c.reject(a.data)}),c.promise},this.getSchedulerList=function(){var c=a.defer();return b({method:"GET",url:API_END_POINT+"/user/schedule/list"}).then(function(a){c.resolve(a.data)},function(a){c.reject(a.data)}),c.promise},this.createSchedule=function(c){var d=a.defer();return b({method:"POST",url:API_END_POINT+"/schedule",data:c}).then(function(a){d.resolve(a.data)},function(a){d.reject(a.data)}),d.promise},this.deleteSchedules=function(c){var d=a.defer();return b({method:"DELETE",url:API_END_POINT+"/schedule/"+c}).then(function(a){d.resolve(a.data)},function(a){d.reject(a.data)}),d.promise},this.showmdToast=function(a,b){c.show(c.simple({textContent:b,hideDelay:3e3,position:"top right",toastClass:a}))}}]),angular.module("schedulerUiApp").directive("ngFileModel",["$parse",function(a){return{restrict:"A",link:function(b,c,d){var e=a(d.ngFileModel),f=d.multiple,g=e.assign;c.bind("change",function(){var a=[];angular.forEach(c[0].files,function(b){var c={name:b.name,size:b.size,url:URL.createObjectURL(b),_file:b};a.push(c)}),b.$apply(function(){f?g(b,a):g(b,a[0])})})}}}]),angular.module("schedulerUiApp").run(["$templateCache",function(a){a.put("views/header.html",'<div class="clearfix header-container"> <h4 class="text-center margin-none"> Scheduler App <button class="signout-btn pull-right" ng-click="signOut();"><i class="fa fa-power-off" aria-hidden="true"></i>SIGN OUT</button> </h4> </div> <div class="empty-div"></div>'),a.put("views/homepage.html",'<div> <div ng-include="\'views/header.html\'"></div> <div class="clearfix"> <div class="side-panel"> <div> <li class="side-panel-li" ng-click="showSchedules = true" ng-class="{\'active\':showSchedules}">My Schedules</li> <li class="side-panel-li" ng-click="showSchedules = false" ng-class="{\'active\':!showSchedules}" ng-show="schedulerRole">Book Schedules</li> </div> </div> <section autoscroll="false" style="background-color: #fff;margin-left: 20%"> <div class="main-container" ng-if="showSchedules"> <div class="col-lg-8" ng-init="getSchedules();"> <p><b>My Schedules:</b></p> <div ng-if="!schedulesList || schedulesList.length == 0"> <span>No schedules found.</span> <span ng-if="schedulerRole"> Please book your schedule...</span> </div> <table class="table table-striped table-bordered" ng-if="schedulesList && schedulesList.length"> <thead> <tr> <th>Name</th> <th>Date</th> <th>Description</th> <th ng-if="schedulerRole">Action</th> </tr> </thead> <tbody> <tr ng-repeat="schedule in schedulesList"> <td ng-if="!schedulerRole">{{schedule.client.userName}}</td> <td ng-if="schedulerRole">{{schedule.user.userName}}</td> <td>{{schedule.displayDate}}</td> <td>{{schedule.description}}</td> <td ng-if="schedulerRole"><i class="fa fa-trash-o cursor-pointer" aria-hidden="true" ng-click="deleteSchedules(schedule.id)"></i></td> </tr> </tbody> </table> </div> </div> <div class="main-container" ng-if="!showSchedules"> <div class="form-container" ng-init="getSchedulerList();"> <form action=""> <p class="color-red">{{errorMsg}}</p> <div class="ip-form-group clearfix"> <span>Scheduler</span> <select name="" id="" ng-model="scheduler.user" ng-options="schedule.id as schedule.userName for schedule in schedulerList"></select> </div> <div class="ip-form-group clearfix"> <span>Description</span> <input type="text" ng-model="scheduler.description"> </div> <div class="ip-form-group clearfix"> <span>Date & Time</span> <input mdc-datetime-picker="" date="true" time="true" type="text" id="datetime" placeholder="Select Date and Time" show-todays-date="" min-date="minDate" format="DD-MM-YYYY HH:mm:ss" ng-model="scheduler.scheduleDate" class="md-input" readonly> </div> <div class="text-center"> <button class="green-btn" ng-click="createSchedule(scheduler)">Submit</button> </div> </form> </div> </div> </section> <div class="loader" ng-show="pageLoader"> <img src="images/loader.15940c91.gif" alt="" class="center-box"> </div> </div> </div>'),a.put("views/login.html",'<div class="loader" ng-show="pageLoader"> <img src="images/loader.15940c91.gif" alt="" class="center-box"> </div> <div class="login-container"> <div class="login-content"> <p class="color-red">{{errorMsg}}</p> <form name="loginForm"> <p> <input name="name" type="text" placeholder="User name" required ng-model="user.name"> </p> <p> <input name="password" type="password" placeholder="Password" required ng-model="user.password"> </p> <p> <button class="green-btn" ng-click="login(loginForm, user)">Login</button> </p> <p ui-sref="signup" class="cursor-pointer">Create account</p> </form> </div> </div>'),a.put("views/signup.html",'<div class="loader" ng-show="pageLoader"> <img src="images/loader.15940c91.gif" alt="" class="center-box"> </div> <div class="login-container"> <div class="login-content"> <p class="color-red">{{errorMsg}}</p> <form name="signupForm"> <div class="ip-form-group clearfix"> <span>User name</span> <input type="text" name="userName" ng-model="user.userName" required> </div> <div class="ip-form-group clearfix"> <span>Password</span> <input type="text" name="password" ng-model="user.password" required> </div> <div class="ip-form-group clearfix"> <span>Confirm Password</span> <input type="text" name="password" ng-model="user.confirmPassword" required> </div> <div class="ip-form-group clearfix"> <span>Time zone</span> <select name="timeZone" ng-model="user.timeZone" ng-options="tz for tz in tzList" required></select> </div> <!--  <div class="ip-form-group clearfix">\n                <span>Can Schedule</span>\n                <input type="checkbox" name="vehicle" value="true" checked ng-model="user.canSchedule">\n            </div> --> <p> <button class="green-btn" ng-click="signup(signupForm, user)">Signup</button> </p> </form> </div> </div>')}]);